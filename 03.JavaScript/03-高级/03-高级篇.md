- [手写Promise.all()](#手写promiseall)
  - [总结Promise.all()的特点](#总结promiseall的特点)
  - [实现Promise.all()](#实现promiseall)
- [手写Promise.race()](#手写promiserace)
  - [总结Promise.race()的特点](#总结promiserace的特点)
  - [实现Promise.race()](#实现promiserace)

### 手写Promise.all()

#### 总结Promise.all()的特点

- `Promise.all()`的使用：Promise.all()可以将多个Promise实例包装成一个新的Promise实例。接收一个promise对象的数组作为参数，当数组中的所有promise对象全部变为resolve或者reject状态时才会去调用.then()。并且，这个数组中的promise对象是并发执行的。

```javascript
var p1 = Promise.resolve('A'),
    p2 = Promise.resolve('B'),
    p3 = Promise.resolve('C');
Promise.all([p1, p2, p3])
    .then((res) => {
        console.log(res) //  ["A", "B", "C"]
    }).catch((e) => {
        console.log(e)
    });
```
上述方法当中，数组[p1, p2, p3]中所有的promise实例都变为resolve时，调用.then()将所有结果传递到res数组中给出最终结果。

```javascript
var p1 = Promise.resolve('A'),
    p2 = Promise.reject('B'),
    p3 = Promise.resolve('C');
Promise.all([p1, p2, p3])
    .then((res) => {
        console.log(res) // 不会调用.then()中的回调
    }).catch((e) => {
        console.log(e) // p2为reject，遇到p2时执行catch，输出"B"
    });
```
上述方法中表示，promise数组中遇到了reject，这时，整个Promise.all调用会立即终止，并返回一个reject的新promise对象。

Promise.all()具有以下特点：
- 输入参数是一个promise实例组成的数组或者具有Iterator 接口的对象
- 如果输入的不是promise对象，会使用Promise.resolve()将其转换成promise对象
- 如果全部成功，则状态变为resolved，返回值将作为一个数组传给then的回调
- 只要有一个失败，状态就变为rejected，返回值将直接传递给catch的回调
- Promise.all()的返回值是一个新的promise对象

#### 实现Promise.all()

```javascript
function promiseAll(iterators) {
    return new Promise((resolve, reject) => {
        if (!Array.isArray(iterators)) {
            return reject(new TypeError('Arguments must be an Array'))
        }
        let count = 0
        let promisesLen = iterator.length
        let res = []
        for(let i in iterators) {
            Promise.resolve(iterators[i])
                .then((val) => {
                    count++
                    res[i] = val
                    if(count == promisesLen) {
                        return resolve(res)
                    }
                }, (err) => {
                    return reject(err)
                })
        }
    })
}
```

![](../../images/Network/promise疑点1.png)

上图中的`[[PromiseResult]]`是什么？如果不传给then，怎么拿到`[[PromiseResult]]`的值？ --- 待探究

### 手写Promise.race()

#### 总结Promise.race()的特点

#### 实现Promise.race()